@using SARCEM_TCC.web.Models
@using Microsoft.AspNet.Identity
@using SARCEM_TCC.web.Helper
@{
    ViewBag.Title = "Appia";
}

<div style="float:left">

    <h2>Informações Appia</h2>
    <h4>Previsão Semestral de Investimentos em obras, que requeiram materiais</h4>
    <h6>Última atualização do usuário em @ViewBag.data</h6>
</div>


<div style="float:right;margin-top: 2%;padding-right: 2%;">

    <h5 id="headerEmpresa"> <span id="spanEmpresa"></span></h5>

    <h5 id="headerDiretoria"><span id="spanDiretoria"></span></h5>

    <h5 id="headeSubDiretoria"><span id="spanSubDiretoria"></span></h5>

</div>

@{
    string dropdow = ControlaAcesso.TrazDropDown(User);

    
}
<div class="row">



    <div id="DropDownsContainer" style="margin-top:1%">

        @Html.Partial(dropdow)

    </div>
</div>



<div id="RadioContainer">
    <div style="margin-top: 2%;">
        @Html.Partial("_RadiosB")
    </div>
</div>

<div style="margin-top: 2%;">



    <div class="pull-right">
        <button id="btn_exporta" class="btn btn-default xlsx">Exporte para Excel</button>
    </div>
</div>






<div class="col-lg-12" style="margin-top:2%;">

    <style>
        th {
            text-align: center;
        }

        .DTFC_LeftBodyLiner {
            top: -12px !important;
        }
    </style>
    <div id="divAppia">
    </div>


</div>

@section scripts
{
    <script>



        var cabecalho
        var dto
        var tipoRetorno
        var brazil

        var data;

        data = new Date();
        AnoAtual = data.getFullYear();






        function CarregaCabecalho() {

            var imgm = $('#imagemLoad')[0]
            imgm.style.display = ""

            dto = {
                Empresa: $('#listaEmpresa').val(),

                Gestor: $('#listaGestor').val(),
                Familia: $('#listaFamilia').val(),
                Material: $('#listaMaterial').val(),
                Diretoria: $('#listaDiretoria').val(),
                SubDiretoria: $('#listaSubDiretoria').val(),

            }

            tipoRetorno = $('input[name=listagem]:checked')[0].defaultValue


            cabecalho = '';
            cabecalho = new Array();

            $.ajax({
                type: 'GET',
                data: {
                    dto

                },
                url: '/api/Appias/TrazDropDown',
                dataSrc: "",
                success: function (d) {

                    cabecalho = d;
                    CriaDropDowm(cabecalho);

                },
                datatype: 'json'

            });


        }



        function CriaDropDowm(cabecalho) {
            if (cabecalho.empresas.length === 1) {

                $('#spanEmpresa')[0].textContent = cabecalho.empresas[0]
                dto.Empresa = cabecalho.empresas[0]
            }
            else
                $('#spanEmpresa')[0].textContent = ""

            if (cabecalho.diretorias.length === 1) {

                $('#spanDiretoria')[0].textContent = cabecalho.diretorias[0]
                dto.Diretoria = cabecalho.diretorias[0]
            }
            else
                $('#spanDiretoria')[0].textContent = ""

            if (cabecalho.subDiretorias.length === 1) {

                $('#spanSubDiretoria')[0].textContent = cabecalho.subDiretorias[0]
                dto.SubDiretoria = cabecalho.subDiretorias[0]
            }
            else
                $('#spanSubDiretoria')[0].textContent = ""



            $('#listaEmpresa').html('');

            if (dto.Empresa === '') {
                $('#listaEmpresa').append("<option value=''></option>");
                cabecalho.empresas.forEach(function (e) {
                    $('#listaEmpresa').append("<option value='" + e + "'>" + e + "</option>");
                });

            } else {
                $('#listaEmpresa').append("<option value='" + dto.Empresa + "' selected>" + dto.Empresa + "</option>");
                //  $('#listaEmpresa').append("<option value='' ></option>");

            }





            $('#listaDiretoria').html('');

            if (dto.Diretoria === '') {
                $('#listaDiretoria').append("<option value=''></option>");
                cabecalho.diretorias.forEach(function (e) {
                    $('#listaDiretoria').append("<option value='" + e + "'>" + e + "</option>");

                });
            } else {
                $('#listaDiretoria').append("<option value='" + dto.Diretoria + "' selected>" + dto.Diretoria + "</option>");
                //  $('#listaDiretoria').append("<option value=''></option>");
            }


            $('#listaSubDiretoria').html('');
            if (dto.SubDiretoria === '') {
                $('#listaSubDiretoria').append("<option value=''></option>");
                cabecalho.subDiretorias.forEach(function (e) {
                    $('#listaSubDiretoria').append("<option value='" + e + "'>" + e + "</option>");
                });
            } else {
                $('#listaSubDiretoria').append("<option value='" + dto.SubDiretoria + "' selected>" + dto.SubDiretoria + "</option>");
                //   $('#listaSubDiretoria').append("<option value=''></option>");
            }



            $('#listaMaterial').html('');
            if (dto.Material === '') {
                $('#listaMaterial').append("<option value=''></option>");
                cabecalho.materiais.forEach(function (e) {
                    $('#listaMaterial').append("<option value='" + e + "'>" + e + "</option>");
                });
            } else {
                $('#listaMaterial').append("<option value='" + dto.Material + "'selected>" + dto.Material + "</option>");
                $('#listaMaterial').append("<option value=''></option>");
            }


            $('#listaFamilia').html('');
            if (dto.Familia === '') {
                $('#listaFamilia').append("<option value=''></option>");
                cabecalho.familias.forEach(function (e) {
                    $('#listaFamilia').append("<option value='" + e + "'>" + e + "</option>");
                });
            } else {
                $('#listaFamilia').append("<option value='" + dto.Familia + "'selected>" + dto.Familia + "</option>");
                $('#listaFamilia').append("<option value=''></option>");
            }

            $('#listaGestor').html('');
            if (dto.Gestor === '') {
                $('#listaGestor').append("<option value=''></option>");
                cabecalho.gestores.forEach(function (e) {
                    $('#listaGestor').append("<option value='" + e + "'>" + e + "</option>");
                });
            } else {
                $('#listaGestor').append("<option value='" + dto.Gestor + "' selected>" + dto.Gestor + "</option>");
                $('#listaGestor').append("<option value=''></option>");
            }




            $('#listaEmpresa').select2({
                theme: "classic",
                placeholder: "Selecione a Empresa",
                language: "pt-BR",
                allowClear: true
            });


            $('#listaDiretoria').select2({
                theme: "classic",
                placeholder: "Selecione a Diretoria",
                language: "pt-BR",
                allowClear: true
            });



            $('#listaSubDiretoria').select2({
                theme: "classic",
                placeholder: "Selecione Macro Processo",
                language: "pt-BR",
                allowClear: true
            });





            $('#listaMaterial').select2({
                theme: "classic",
                placeholder: "Selecione o Material",
                language: "pt-BR",
                allowClear: true
            });

            $('#listaFamilia').select2({
                theme: "classic",
                placeholder: "Selecione a Família",
                language: "pt-BR",
                allowClear: true
            });

            $('#listaGestor').select2({
                theme: "classic",
                placeholder: "Selecione o Gestor",
                language: "pt-BR",
                allowClear: true
            });


            var estilo = $('.select2');

            for (var i = 0; i < estilo.length; i++) {
                estilo[i].style.width = '100%';
            }

            criaTabela();

        }

        function criaTabela() {




            var sb = $('#divAppia')




            sb.html('');

            switch (tipoRetorno) {

                case 'porDiretoria':
                    {

                        sb.append("<table id='tabelaAppia' class='table table- striped text- nowrap table- hover'>" +
                            "<thead> <tr>" +

                            " <th>Empresa</th>" +
                            " <th>Material</th>" +
                            "<th>Descrição do Material</th>" +
                            "<th>Unidade de Medida</th>" +
                            "<th>Classe</th>" +
                            "<th>classificacao</th>" +
                            "<th>Família</th>" +
                            "<th>MG Code</th>" +
                            "<th>Descricao do MG Code</th>" +
                            "<th>Gestor</th>" +
                            " <th>Diretoria    </th>" +
                            //" <th>Data da Atualização    </th>" +
                            " <th>Média em " + AnoAtual + "  </th>" +
                            " <th>Total em " + AnoAtual + "  </th>" +
                            " <th>Média em " + (AnoAtual + 1) + "  </th>" +
                            " <th>Total em " + (AnoAtual + 1) + "  </th>" +
                            " <th>Média em " + (AnoAtual + 2) + "  </th>" +
                            " <th>Total em " + (AnoAtual + 2) + "  </th>" +
                            " <th>Média no Triênio   </th>" +
                            " <th>Total no Triênio  </th>" +
                            "   <th>Material Bloqueado</th> " +
                            "   <th>Material Substituido</th> " +



                            " </tr> </thead>" +
                            "<tbody> </tbody> </table >");



                        tabela = $("#tabelaAppia").DataTable({

                            ajax: {
                                type: 'GET',
                                data: {
                                    dto,
                                    tipoC: tipoRetorno,


                                },
                                url: '/api/Appias/ListaAppia',
                                dataSrc: "",
                            },
                            columns: [

                                { data: "empresa" },
                                { data: "materia" },
                                { data: "descricao" },
                                { data: "um" },
                                { data: "classe" },
                                { data: "classificacao" },
                                { data: "familiaNome" },
                                { data: "mgCocde" },
                                { data: "mgCodeDescricao" },
                                { data: "gestor" },
                                { data: "diretoria" },
                                //{ data: "appiaDataLanc" },
                                { data: "medCurrYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totCurrYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "medAfterYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totAfterYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "medAfterYearPlusOne", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totAfterYearPlusOne", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "medTrienio", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totTrienio", render: $.fn.dataTable.render.number('.', ',', 2) },

                                {
                                    data: "materialBloqueado",
                                    render: function (data, type, material, td) {

                                        if (material.materialBloqueado) {

                                            return "x";
                                        }


                                        return null;


                                    }
                                },
                                { data: "materialSubstituto" },


                            ],

                            "scrollX": true,
                            "scrollY": "360px",

                            "scrollCollapse": true,
                            "deferRender": true,
                            "fixedColumns": {
                                leftColumns: 2,
                            },
                            "createdRow": function (row, data, dataIndex) {
                                if (data.materialBloqueado != false) {
                                    $(row).addClass('red');

                                }


                            }

                        });

                        break;

                    }


                case 'porSubDiretoria':
                    {
                        sb.append("<table id='tabelaAppia' class='table table- striped text- nowrap table- hover'>" +
                            "<thead> <tr>" +

                            " <th>Empresa</th>" +
                            " <th>Material</th>" +
                            "<th>Descrição do Material</th>" +
                            "<th>Unidade de Medida</th>" +
                            "<th>Classe</th>" +
                            "<th>classificacao</th>" +
                            "<th>Família</th>" +
                            "<th>MG Code</th>" +
                            "<th>Descricao do MG Code</th>" +
                            "<th>Gestor</th>" +
                            " <th>Diretoria    </th>" +
                            " <th>Macro Processo </th>" +
                            //" <th>Data da Atualização    </th>" +
                            " <th>Média em " + AnoAtual + "  </th>" +
                            " <th>Total em " + AnoAtual + "  </th>" +
                            " <th>Média em " + (AnoAtual + 1) + "  </th>" +
                            " <th>Total em " + (AnoAtual + 1) + "  </th>" +
                            " <th>Média em " + (AnoAtual + 2) + "  </th>" +
                            " <th>Total em " + (AnoAtual + 2) + "  </th>" +
                            " <th>Média no Triênio   </th>" +
                            " <th>Total no Triênio  </th>" +

                            "   <th>Material Bloqueado</th> " +
                            "   <th>Material Substituido</th> " +

                            " </tr> </thead>" +
                            "<tbody> </tbody> </table >");



                        tabela = $("#tabelaAppia").DataTable({

                            ajax: {
                                type: 'GET',
                                data: {

                                    dto,
                                    tipoC: tipoRetorno,


                                },
                                url: '/api/Appias/ListaAppia',
                                dataSrc: ""
                            },
                            columns: [

                                { data: "empresa" },
                                { data: "materia" },
                                { data: "descricao" },
                                { data: "um" },
                                { data: "classe" },
                                { data: "classificacao" },
                                { data: "familiaNome" },
                                { data: "mgCocde" },
                                { data: "mgCodeDescricao" },
                                { data: "gestor" },
                                { data: "diretoria" },
                                { data: "subDiretoria" },
                                //{ data: "appiaDataLanc" },
                                { data: "medCurrYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totCurrYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "medAfterYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totAfterYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "medAfterYearPlusOne", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totAfterYearPlusOne", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "medTrienio", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totTrienio", render: $.fn.dataTable.render.number('.', ',', 2) },
                                {
                                    data: "materialBloqueado",
                                    render: function (data, type, material, td) {

                                        if (material.materialBloqueado) {

                                            return "x";
                                        }


                                        return null;


                                    }
                                },
                                { data: "materialSubstituto" },


                            ],

                            "scrollX": true,
                            "scrollY": "360px",

                            "scrollCollapse": true,
                            "deferRender": true,
                            "fixedColumns": {
                                leftColumns: 2,
                            },
                            "createdRow": function (row, data, dataIndex) {
                                if (data.materialBloqueado != false) {
                                    $(row).addClass('red');

                                }


                            }



                        });
                        break;
                    }


                case 'porProjeto':
                    {
                        sb.append("<table id='tabelaAppia' class='table table- striped text- nowrap table- hover'>" +
                            "<thead> <tr>" +

                            " <th>Empresa</th>" +
                            " <th>Material</th>" +
                            "<th>Descrição do Material</th>" +
                            "<th>Unidade de Medida</th>" +
                            "<th>Classe</th>" +
                            "<th>classificacao</th>" +
                            "<th>Família</th>" +
                            "<th>MG Code</th>" +
                            "<th>Descricao do MG Code</th>" +
                            "<th>Gestor</th>" +
                            " <th>Diretoria    </th>" +
                            " <th>Macro Processo </th>" +
                            " <th>Proejto </th>" +
                            " <th>Informações Adicionais</th>" +
                            " <th>Responsável</th>" +
                            //" <th>Data da Atualização    </th>" +
                            " <th>Média em " + AnoAtual + "  </th>" +
                            " <th>Total em " + AnoAtual + "  </th>" +
                            " <th>Média em " + (AnoAtual + 1) + "  </th>" +
                            " <th>Total em " + (AnoAtual + 1) + "  </th>" +
                            " <th>Média em " + (AnoAtual + 2) + "  </th>" +
                            " <th>Total em " + (AnoAtual + 2) + "  </th>" +
                            " <th>Média no Triênio   </th>" +
                            " <th>Total no Triênio  </th>" +

                            "   <th>Material Bloqueado</th> " +
                            "   <th>Material Substituido</th> " +

                            " </tr> </thead>" +
                            "<tbody> </tbody> </table >");



                        tabela = $("#tabelaAppia").DataTable({

                            ajax: {
                                type: 'GET',
                                data: {

                                    dto,
                                    tipoC: tipoRetorno,


                                },
                                url: '/api/Appias/ListaAppia',
                                dataSrc: ""
                            },
                            columns: [

                                { data: "empresa" },
                                { data: "materia" },
                                { data: "descricao" },
                                { data: "um" },
                                { data: "classe" },
                                { data: "classificacao" },
                                { data: "familiaNome" },
                                { data: "mgCocde" },
                                { data: "mgCodeDescricao" },
                                { data: "gestor" },
                                { data: "diretoria" },
                                { data: "subDiretoria" },
                                { data: "projeto" },
                                { data: "infoAdicional" },
                                { data: "responsavel" },
                                //{ data: "appiaDataLanc" },
                                { data: "medCurrYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totCurrYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "medAfterYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totAfterYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "medAfterYearPlusOne", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totAfterYearPlusOne", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "medTrienio", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totTrienio", render: $.fn.dataTable.render.number('.', ',', 2) },

                                {
                                    data: "materialBloqueado",
                                    render: function (data, type, material, td) {

                                        if (material.materialBloqueado) {

                                            return "x";
                                        }


                                        return null;


                                    }
                                },
                                { data: "materialSubstituto" },


                            ],

                            "scrollX": true,
                            "scrollY": "360px",

                            "scrollCollapse": true,
                            "deferRender": true,
                            "fixedColumns": {
                                leftColumns: 2,
                            },
                            "createdRow": function (row, data, dataIndex) {
                                if (data.materialBloqueado != false) {
                                    $(row).addClass('red');

                                }


                            }



                        });
                        break;
                    }

                case 'porResumo':
                    {



                        sb.append("<table id='tabelaAppia' class='table table- striped text- nowrap table- hover'>" +
                            "<thead> <tr>" +
                            " <th>Macro Processo </th>" +
                            //" <th>Média em " + AnoAtual + " em R$  </th>" +
                            " <th>Total em " + AnoAtual + " em R$  </th>" +
                            //" <th>Média em " + (AnoAtual + 1) + " em R$  </th>" +
                            " <th>Total em " + (AnoAtual + 1) + " em R$  </th>" +
                            // " <th>Média em " + (AnoAtual + 2) + " em R$   </th>" +
                            " <th>Total em " + (AnoAtual + 2) + " em R$   </th>" +
                            //" <th>Média no Triênio em R$  </th>" +
                            //" <th>Total no Triênio  em R$ </th>" +
                            //" <th>Data da Atualização    </th>" +



                            " </tr> </thead>" +
                            "<tbody> </tbody> </table >");



                        tabela = $("#tabelaAppia").DataTable({

                            ajax: {
                                type: 'GET',
                                data: {
                                    dto,
                                    tipoC:
                                        tipoRetorno,

                                },
                                url: '/api/Appias/ListaAppia',
                                dataSrc: "",
                            },
                            columns: [
                                { data: "subDiretoria" },
                                //    { data: "medCurrYearEmReal", render: $.fn.dataTable.render.number('.', ',', 2, "R$ ") },
                                { data: "totCurrYearEmReal", render: $.fn.dataTable.render.number('.', ',', 2, "R$ ") },
                                //  { data: "medAfterYearEmReal", render: $.fn.dataTable.render.number('.', ',', 2, "R$ ") },
                                { data: "totAfterYearEmReal", render: $.fn.dataTable.render.number('.', ',', 2, "R$ ") },
                                // { data: "medAfterYearPlusOneEmReal", render: $.fn.dataTable.render.number('.', ',', 2, "R$ ") },
                                { data: "totAfterYearPlusOneEmReal", render: $.fn.dataTable.render.number('.', ',', 2, "R$ ") },
                                //{ data: "medTrienioEmReal", render: $.fn.dataTable.render.number('.', ',', 2, "R$ ") },
                                //{ data: "totTrienioEmReal", render: $.fn.dataTable.render.number('.', ',', 2, "R$ ") },
                                //{ data: "appiaDataLanc" },

                            ],

                            "scrollX": false,
                            "scrollY": "300px",
                            "paging": false,
                            "searching": false,
                            "scrollCollapse": true,
                            "deferRender": true,

                        });

                        break;
                    }

                default:
                    {



                        sb.append("<table id='tabelaAppia' class='table table- striped text- nowrap table- hover'>" +
                            "<thead> <tr>" +

                            " <th>Empresa</th>" +
                            " <th>Material</th>" +
                            "<th>Descrição do Material</th>" +
                            "<th>Unidade de Medida</th>" +
                            "<th>Classe</th>" +
                            "<th>classificacao</th>" +
                            "<th>Família</th>" +
                            "<th>MG Code</th>" +
                            "<th>Descricao do MG Code</th>" +
                            "<th>Gestor</th>" +
                            //" <th>Data da Atualização    </th>" +
                            " <th>Média em " + AnoAtual + "  </th>" +
                            " <th>Total em " + AnoAtual + "  </th>" +
                            " <th>Média em " + (AnoAtual + 1) + "  </th>" +
                            " <th>Total em " + (AnoAtual + 1) + "  </th>" +
                            " <th>Média em " + (AnoAtual + 2) + "  </th>" +
                            " <th>Total em " + (AnoAtual + 2) + "  </th>" +
                            " <th>Média no Triênio   </th>" +
                            " <th>Total no Triênio  </th>" +

                            "   <th>Material Bloqueado</th> " +
                            "   <th>Material Substituido</th> " +

                            " </tr> </thead>" +
                            "<tbody> </tbody> </table >");



                        tabela = $("#tabelaAppia").DataTable({

                            ajax: {
                                type: 'GET',
                                data: {
                                    dto,
                                    tipoC:
                                        tipoRetorno,

                                },
                                url: '/api/Appias/ListaAppia',
                                dataSrc: "",
                            },
                            columns: [

                                { data: "empresa" },
                                { data: "materia" },
                                { data: "descricao" },
                                { data: "um" },
                                { data: "classe" },
                                { data: "classificacao" },
                                { data: "familiaNome" },
                                { data: "mgCocde" },
                                { data: "mgCodeDescricao" },
                                { data: "gestor" },
                                //{ data: "appiaDataLanc" },
                                { data: "medCurrYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totCurrYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "medAfterYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totAfterYear", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "medAfterYearPlusOne", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totAfterYearPlusOne", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "medTrienio", render: $.fn.dataTable.render.number('.', ',', 2) },
                                { data: "totTrienio", render: $.fn.dataTable.render.number('.', ',', 2) },
                                {
                                    data: "materialBloqueado",
                                    render: function (data, type, material, td) {

                                        if (material.materialBloqueado) {

                                            return "x";
                                        }


                                        return null;


                                    }
                                },
                                { data: "materialSubstituto" },


                            ],

                            "scrollX": true,
                            "scrollY": "360px",

                            "scrollCollapse": true,
                            "deferRender": true,
                            "fixedColumns": {
                                leftColumns: 2,
                            },
                            "createdRow": function (row, data, dataIndex) {
                                if (data.materialBloqueado != false) {
                                    $(row).addClass('red');

                                }


                            }



                        });

                        break;
                    }
            }
            var imgm = $('#imagemLoad')[0]
            imgm.style.display = "none"
        }

        function ExportaPagina(result) {
            table = '';

            dataRst = '';



            dataRst = new Array();


            var i = 1;


            switch (tipoRetorno) {


                case 'porDiretoria':
                    {

                        dataRst[0] = [
                            { v: 'Empresa', t: 's' },
                            { v: 'Material', t: 's' },
                            { v: 'Descrição do Material', t: 's' },
                            { v: 'Unidade de Medida', t: 's' },
                            { v: 'Classe', t: 's' },
                            { v: 'classificacao', t: 's' },
                            { v: 'Família', t: 's' },
                            { v: 'MG Code', t: 's' },
                            { v: 'Descricao do MG Code', t: 's' },
                            { v: 'Gestor', t: 's' },
                            { v: 'Diretoria', t: 's' },
                            { v: 'Data da Atualização', t: 's' },
                            { v: 'Média em ' + AnoAtual, t: 's' },
                            { v: 'Total em ' + AnoAtual, t: 's' },
                            { v: 'Média em ' + (AnoAtual + 1), t: 's' },
                            { v: 'Total em ' + (AnoAtual + 1), t: 's' },
                            { v: 'Média em ' + (AnoAtual + 2), t: 's' },
                            { v: 'Total em ' + (AnoAtual + 2), t: 's' },
                            { v: 'Média no Triênio', t: 's' },
                            { v: 'Total no Triênio', t: 's' },
                            { v: 'Material Bloqueado', t: 's' },
                            { v: 'Material Substituido', t: 's' },

                        ];

                        result.forEach(function (r) {

                            dataRst[i] = [
                                { v: r.empresa, t: 's' },
                                { v: r.materia, t: 's' },
                                { v: r.descricao, t: 's' },
                                { v: r.um, t: 's' },
                                { v: r.classe, t: 's' },
                                { v: r.classificacao, t: 's' },
                                { v: r.familiaNome, t: 's' },
                                { v: r.mgCocde, t: 's' },
                                { v: r.mgCodeDescricao, t: 's' },
                                { v: r.gestor, t: 's' },
                                { v: r.diretoria, t: 's' },
                                { v: r.appiaDataLanc, t: 'd' },
                                { v: r.medCurrYear, t: 'n' },
                                { v: r.totCurrYear, t: 'n' },
                                { v: r.medAfterYear, t: 'n' },
                                { v: r.totAfterYear, t: 'n' },
                                { v: r.medAfterYearPlusOne, t: 'n' },
                                { v: r.totAfterYearPlusOne, t: 'n' },
                                { v: r.medTrienio, t: 'n' },
                                { v: r.totTrienio, t: 'n' },
                                { v: r.materialBloqueado, t: 's' },
                                { v: r.materialSubstituto, t: 's' },
                            ]
                            i++;
                        });

                        break;

                    }


                case 'porSubDiretoria':
                    {
                        dataRst[0] = [
                            { v: 'Empresa', t: 's' },
                            { v: 'Material', t: 's' },
                            { v: 'Descrição do Material', t: 's' },
                            { v: 'Unidade de Medida', t: 's' },
                            { v: 'Classe', t: 's' },
                            { v: 'classificacao', t: 's' },
                            { v: 'Família', t: 's' },
                            { v: 'MG Code', t: 's' },
                            { v: 'Descricao do MG Code', t: 's' },
                            { v: 'Gestor', t: 's' },
                            { v: 'Diretoria', t: 's' },
                            { v: 'Macro Processo', t: 's' },
                            { v: 'Data da Atualização', t: 's' },
                            { v: 'Média em ' + AnoAtual, t: 's' },
                            { v: 'Total em ' + AnoAtual, t: 's' },
                            { v: 'Média em ' + (AnoAtual + 1), t: 's' },
                            { v: 'Total em ' + (AnoAtual + 1), t: 's' },
                            { v: 'Média em ' + (AnoAtual + 2), t: 's' },
                            { v: 'Total em ' + (AnoAtual + 2), t: 's' },
                            { v: 'Média no Triênio', t: 's' },
                            { v: 'Total no Triênio', t: 's' },
                            { v: 'Material Bloqueado', t: 's' },
                            { v: 'Material Substituido', t: 's' },
                        ];

                        result.forEach(function (r) {

                            dataRst[i] = [
                                { v: r.empresa, t: 's' },
                                { v: r.materia, t: 's' },
                                { v: r.descricao, t: 's' },
                                { v: r.um, t: 's' },
                                { v: r.classe, t: 's' },
                                { v: r.classificacao, t: 's' },
                                { v: r.familiaNome, t: 's' },
                                { v: r.mgCocde, t: 's' },
                                { v: r.mgCodeDescricao, t: 's' },
                                { v: r.gestor, t: 's' },
                                { v: r.diretoria, t: 's' },
                                { v: r.subDiretoria, t: 's' },
                                { v: r.appiaDataLanc, t: 'd' },
                                { v: r.medCurrYear, t: 'n' },
                                { v: r.totCurrYear, t: 'n' },
                                { v: r.medAfterYear, t: 'n' },
                                { v: r.totAfterYear, t: 'n' },
                                { v: r.medAfterYearPlusOne, t: 'n' },
                                { v: r.totAfterYearPlusOne, t: 'n' },
                                { v: r.medTrienio, t: 'n' },
                                { v: r.totTrienio, t: 'n' },
                                { v: r.materialBloqueado, t: 's' },
                                { v: r.materialSubstituto, t: 's' },
                            ]
                            i++;
                        });
                        break;
                    }


                case 'porProjeto':
                    {
                        dataRst[0] = [
                            { v: 'Empresa', t: 's' },
                            { v: 'Material', t: 's' },
                            { v: 'Descrição do Material', t: 's' },
                            { v: 'Unidade de Medida', t: 's' },
                            { v: 'Classe', t: 's' },
                            { v: 'classificacao', t: 's' },
                            { v: 'Família', t: 's' },
                            { v: 'MG Code', t: 's' },
                            { v: 'Descricao do MG Code', t: 's' },
                            { v: 'Gestor', t: 's' },
                            { v: 'Diretoria', t: 's' },
                            { v: 'Macro Processo', t: 's' },
                            { v: 'Projeto', t: 's' },
                            { v: 'Informações Adicionais', t: 's' },
                            { v: 'Responsável', t: 's' },
                            { v: 'Data da Atualização', t: 's' },
                            { v: 'Média em ' + AnoAtual, t: 's' },
                            { v: 'Total em ' + AnoAtual, t: 's' },
                            { v: 'Média em ' + (AnoAtual + 1), t: 's' },
                            { v: 'Total em ' + (AnoAtual + 1), t: 's' },
                            { v: 'Média em ' + (AnoAtual + 2), t: 's' },
                            { v: 'Total em ' + (AnoAtual + 2), t: 's' },
                            { v: 'Média no Triênio', t: 's' },
                            { v: 'Total no Triênio', t: 's' },
                            { v: 'Material Bloqueado', t: 's' },
                            { v: 'Material Substituido', t: 's' },
                        ];

                        result.forEach(function (r) {

                            dataRst[i] = [
                                { v: r.empresa, t: 's' },
                                { v: r.materia, t: 's' },
                                { v: r.descricao, t: 's' },
                                { v: r.um, t: 's' },
                                { v: r.classe, t: 's' },
                                { v: r.classificacao, t: 's' },
                                { v: r.familiaNome, t: 's' },
                                { v: r.mgCocde, t: 's' },
                                { v: r.mgCodeDescricao, t: 's' },
                                { v: r.gestor, t: 's' },
                                { v: r.diretoria, t: 's' },
                                { v: r.subDiretoria, t: 's' },
                                { v: r.projeto, t: 's' },
                                { v: r.infoAdicional, t: 's' },
                                { v: r.responsavel, t: 's' },
                                { v: r.appiaDataLanc, t: 'd' },
                                { v: r.medCurrYear, t: 'n' },
                                { v: r.totCurrYear, t: 'n' },
                                { v: r.medAfterYear, t: 'n' },
                                { v: r.totAfterYear, t: 'n' },
                                { v: r.medAfterYearPlusOne, t: 'n' },
                                { v: r.totAfterYearPlusOne, t: 'n' },
                                { v: r.medTrienio, t: 'n' },
                                { v: r.totTrienio, t: 'n' },
                                { v: r.materialBloqueado, t: 's' },
                                { v: r.materialSubstituto, t: 's' },
                            ]
                            i++;
                        });
                        break;
                    }


                case 'porResumo':
                    {
                        dataRst[0] = [
                            { v: 'Macro Processo', t: 's' },
                            //  { v: 'Média em ' + AnoAtual, t: 's' },
                            { v: 'Total em ' + AnoAtual, t: 's' },
                            //  { v: 'Média em ' + (AnoAtual + 1), t: 's' },
                            { v: 'Total em ' + (AnoAtual + 1), t: 's' },
                            //  { v: 'Média em ' + (AnoAtual + 2), t: 's' },
                            { v: 'Total em ' + (AnoAtual + 2), t: 's' },
                            //  { v: 'Média no Triênio', t: 's' },
                            { v: 'Total no Triênio', t: 's' },
                            { v: 'Data da Atualização', t: 's' },

                        ];

                        result.forEach(function (r) {

                            dataRst[i] = [
                                { v: r.subDiretoria, t: 's' },
                                //   { v: r.medCurrYearEmReal, t: 'n' },
                                { v: r.totCurrYearEmReal, t: 'n' },
                                //  { v: r.medAfterYearEmReal, t: 'n' },
                                { v: r.totAfterYearEmReal, t: 'n' },
                                // { v: r.medAfterYearPlusOneEmReal, t: 'n' },
                                { v: r.totAfterYearPlusOneEmReal, t: 'n' },
                                //  { v: r.medTrienioEmReal, t: 'n' },
                                { v: r.totTrienioEmReal, t: 'n' },
                                { v: r.appiaDataLanc, t: 'd' },
                            ]
                            i++;
                        });
                        break;
                    }

                default:
                    {
                        dataRst[0] = [

                            { v: 'Empresa', t: 's' },
                            { v: 'Material', t: 's' },
                            { v: 'Descrição do Material', t: 's' },
                            { v: 'Unidade de Medida', t: 's' },
                            { v: 'Classe', t: 's' },
                            { v: 'classificacao', t: 's' },
                            { v: 'Família', t: 's' },
                            { v: 'MG Code', t: 's' },
                            { v: 'Descricao do MG Code', t: 's' },
                            { v: 'Gestor', t: 's' },
                            { v: 'Data da Atualização', t: 's' },
                            { v: 'Média em ' + AnoAtual, t: 's' },
                            { v: 'Total em ' + AnoAtual, t: 's' },
                            { v: 'Média em ' + (AnoAtual + 1), t: 's' },
                            { v: 'Total em ' + (AnoAtual + 1), t: 's' },
                            { v: 'Média em ' + (AnoAtual + 2), t: 's' },
                            { v: 'Total em ' + (AnoAtual + 2), t: 's' },
                            { v: 'Média no Triênio', t: 's' },
                            { v: 'Total no Triênio', t: 's' },
                            { v: 'Material Bloqueado', t: 's' },
                            { v: 'Material Substituido', t: 's' },
                        ];

                        result.forEach(function (r) {

                            dataRst[i] = [
                                { v: r.empresa, t: 's' },
                                { v: r.materia, t: 's' },
                                { v: r.descricao, t: 's' },
                                { v: r.um, t: 's' },
                                { v: r.classe, t: 's' },
                                { v: r.classificacao, t: 's' },
                                { v: r.familiaNome, t: 's' },
                                { v: r.mgCocde, t: 's' },
                                { v: r.mgCodeDescricao, t: 's' },
                                { v: r.gestor, t: 's' },
                                { v: r.appiaDataLanc, t: 'd' },
                                { v: r.medCurrYear, t: 'n' },
                                { v: r.totCurrYear, t: 'n' },
                                { v: r.medAfterYear, t: 'n' },
                                { v: r.totAfterYear, t: 'n' },
                                { v: r.medAfterYearPlusOne, t: 'n' },
                                { v: r.totAfterYearPlusOne, t: 'n' },
                                { v: r.medTrienio, t: 'n' },
                                { v: r.totTrienio, t: 'n' },
                                { v: r.materialBloqueado, t: 's' },
                                { v: r.materialSubstituto, t: 's' },
                            ]
                            i++;
                        });

                        break;
                    }
            }

            var table = $('#tabelaAppia').tableExport();
            table.export2file(dataRst, 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'Extrato_Appia', '.xlsx')
            var botao = $('#btn_exporta')[0]
            var imagem = $('#imagemLoad')[0]
            imagem.style.display = "none"
            botao.style.visibility = "visible"

        }







        $(document).ready(function () {

            brazil = @User.IsInRole(RoleName.Brazil).ToString().ToLower()

            CarregaCabecalho();

            $('.demo-default').on("change", function () {
                CarregaCabecalho()
            });

            $('.radio').on('change', function () {
                tipoRetorno = $('input[name=listagem]:checked')[0].defaultValue

                criaTabela();

            });

            $('.checkbox').on('change', function () {
                tipoRetorno = $('input[name=listagem]:checked')[0].defaultValue

                criaTabela();

            });

            $('#btn_exporta').on('click', function () {
                var botao = $('#btn_exporta')[0]
                var imagem = $('#imagemLoad')[0]
                imagem.style.display = ""
                botao.style.visibility = 'hidden'

                $.ajax({
                    type: 'GET',
                    data: {

                        dto,
                        tipoC: tipoRetorno,


                    },
                    url: '/api/Appias/ListaAppia',
                    dataSrc: "",
                    success: function (d) {

                        ExportaPagina(d);


                    }

                })

            });

        });
    </script>
}
